<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>취미 게시글</title>
    <style>
        .button-container button {
            display: inline-block;
            margin-right: 10px;
            float: right;
        }
        .container {
            text-align: center;
            margin-top: 50px;
        }
        .table-container {
            margin-top: 30px;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }
        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination button {
            margin: 0 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <div style="text-align: center; margin-top: 100px;">
        <h2>취미 게시글</h2>
        <div class="button-container">
            <button th:if="${isLoggedIn}" onclick="logout()">로그아웃</button>
            <button th:if="${isLoggedIn}" th:onclick="|location.href='@{/post/write}'|" type="button">글 작성하기</button>
            <button th:if="${!isLoggedIn}" th:onclick="|location.href='@{/login}'|" type="button">로그인</button>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>제목</th>
                <th>작성자</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="post : ${posts}" th:action="@{/post/{postId}(postId=${post.id})}" class="get">
                <td th:text="${post.id}"></td>
                <td>
                    <a th:href="@{/post/{postId}(postId=${post.id})}" th:text="${post.title}"></a>
                </td>
                <td th:text="${post.content}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="pagination">
        <button id="prevPageBtn" onclick="changePage(-1)">이전</button>
        <span id="currentPage" th:text="${currentPage}"></span>
        <button id="nextPageBtn" onclick="changePage(1)">다음</button>
    </div>
</div>

<script>
    let currentPage = 1;
    const pageSize = 10;

    // 페이지 변경 함수
    function changePage(offset) {
        const newPage = currentPage + offset;
        loadPosts(newPage);
    }

    function loadPosts(page) {
        fetch(`/posts?page=${page}&size=${pageSize}`)
            .then(response => response.json())
            .then(data => {
                const postList = document.querySelector('tbody');
                postList.innerHTML = ''; // 기존 게시글 목록 초기화

                data.posts.forEach(post => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${post.id}</td>
                        <td><a href="/post/${post.id}">${post.title}</a></td>
                        <td>${post.content}</td>
                    `;
                    postList.appendChild(row);
                });

                const totalPosts = data.totalPostCount;
                document.getElementById('prevPageBtn').disabled = page <= 1;
                document.getElementById('nextPageBtn').disabled = page * pageSize >= totalPosts;
                currentPage = page;
                document.getElementById('currentPage').innerText = currentPage;
            })
            .catch(error => console.error('Error fetching posts:', error));
    }


    function logout() {
        fetch('/logout', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        }).then(response => {
            if (response.ok) {
                window.location.href = '/post';
            } else {
                alert("로그아웃 중 오류가 발생했습니다.");
            }
        }).catch(error => {
            console.error("Error:", error);
            alert("로그아웃 중 오류가 발생했습니다.");
        });
    }
</script>
</body>
</html>